/*
 * Copyright (c) 2019-present Sonatype, Inc.
 * This program and the accompanying materials are made available under
 * the terms of the Eclipse Public License 2.0 which accompanies this
 * distribution and is available at https://www.eclipse.org/legal/epl-2.0/.
 */
import React, { FunctionComponent, ReactElement } from 'react';
import NxTooltip from '../NxTooltip/NxTooltip';

import {
  cvssSeverityRangeMap,
  getVulnerabilitySeverityLevel,
  VulnerabilitySeverityLevel
} from '../../util/vulnerabilitySeverityLevels';
import { Props, propTypes } from './types';
export { Props } from './types';

import './NxVulnerabilityIndicator.scss';
import classnames from 'classnames';

const capitalize = (string: string) => string.charAt(0).toUpperCase() + string.slice(1);

const NxVulnerabilityIndicator: FunctionComponent<Props> =
  function NxVulnerabilityIndicator(props): ReactElement<Props> {
    const {
          title,
          severityLevel,
          score,
          className: classNameProp,
          presentational
        } = props,
        severity: VulnerabilitySeverityLevel = severityLevel
          ? severityLevel
          : score !== undefined
            ? getVulnerabilitySeverityLevel(score) || 'none'
            : 'none',
        className = classnames(
            classNameProp,
            `nx-vulnerability-indicator nx-vulnerability-indicator--${severity} nx-icon--colorful`
        ),
        label = `vulnerability level ${severity}`;

    const icon = (
      <div aria-label={presentational ? undefined : label}
           className={className}
           role={presentational ? 'presentation' : 'graphics-symbol img'}/>
    );

    return presentational ? icon : (
      <NxTooltip title={title || `Vulnerability: ${capitalize(severity)} (${cvssSeverityRangeMap[severity]})`}>
        {icon}
      </NxTooltip>
    );
  };

NxVulnerabilityIndicator.propTypes = propTypes;

export default NxVulnerabilityIndicator;
