/*
 * Copyright (c) 2019-present Sonatype, Inc.
 * This program and the accompanying materials are made available under
 * the terms of the Eclipse Public License 2.0 which accompanies this
 * distribution and is available at https://www.eclipse.org/legal/epl-2.0/.
 */
@use '../../scss-shared/nx-text-helpers';

// returns a data URL for a triangular caret SVG of the specified color.
// Unfortunately CSS url() functions must take the whole literal URL as their parameter
// with no way to do any sort of interpolation from CSS variables, so this must be done in scss, using
// values copied in code from the CSS variables. NOTE: color must be URL-escaped before being passed in!
@function caret-with-color($color) {
  @return "data:image/svg+xml;utf8, \
    <svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' fill='#{$color}'> \
    <polygon points='0,0 100,0 50,50'/></svg>";
}

.nx-form-select {
  display: inline-block;
  margin-bottom: var(--nx-spacing-8x);
  position: relative;
  width: var(--nx-width-form-element-normal);
  max-width: 100%;

  &__select {
    @include nx-text-helpers.regular;
    $caret: caret-with-color('hsl(0, 0%25, 10%25)');
    $icon-size: 12px;

    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-color: var(--nx-swatch-white);
    background-image: url($caret);
    background-size: $icon-size;
    background-position: calc(100% - var(--nx-spacing-4x)) 16px;
    background-repeat: no-repeat;
    border: 1px solid var(--nx-color-form-element-border);
    border-radius: var(--nx-border-radius);
    color: var(--nx-color-text);
    font-size: var(--nx-font-size);
    line-height: var(--nx-line-height);
    text-overflow: ellipsis;
    padding:
      calc(var(--nx-spacing-2x) - 1px)
      calc(var(--nx-spacing-4x) + #{$icon-size} + var(--nx-spacing-6x) - 1px)
      calc(var(--nx-spacing-2x) - 1px)
      calc(var(--nx-spacing-4x) - 1px);
    width: 100%;

    &:hover {
      border-color: var(--nx-color-form-element-border);
    }

    &:focus {
      box-shadow: var(--nx-box-shadow-focus);
      border-color: var(--nx-color-interactive-border-focus);
      outline: none;
    }

  }

  &--long {
    width: var(--nx-width-form-element-wide);
  }

  &--short {
    width: var(--nx-width-form-element-short);
  }

  &, &.pristine, &.pristine.valid {
    .nx-form-select__select {
      &:hover {
        border-color: var(--nx-color-interactive-border-hover);
      }

      &:focus {
        border-color: var(--nx-color-interactive-border-focus);
        box-shadow: var(--nx-box-shadow-focus);
      }
    }
  }

  // styles which must appear this var down to override some with equal precedence higher up
  &__select {
    &[disabled] {
      &, &:hover {
        $disabled-caret: caret-with-color('hsl(0, 0%25, 60%25)');

        color: var(--nx-color-text-disabled);
        background-color: var(--nx-color-interactive-background-disabled);
        background-image: url($disabled-caret);
        border-color: var(--nx-color-interactive-border-disabled);
      }
    }
  }
}

.nx-form--show-validation-errors .nx-form-select, .nx-form-select:not(.pristine) {
  &:not(.disabled) {
    &.valid {
      .nx-form-select__select {
        border-color: var(--nx-color-validation-valid);
      }
    }

    &.invalid {
      .nx-form-select__select {
        border-color: var(--nx-color-validation-invalid);
      }
    }
  }
}
