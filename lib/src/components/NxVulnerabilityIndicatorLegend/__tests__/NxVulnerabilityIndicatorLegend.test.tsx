/*
 * Copyright (c) 2019-present Sonatype, Inc.
 * This program and the accompanying materials are made available under
 * the terms of the Eclipse Public License 2.0 which accompanies this
 * distribution and is available at https://www.eclipse.org/legal/epl-2.0/.
 */
import React from 'react';

import { rtlRender, rtlRenderElement } from '../../../__testutils__/rtlUtils';
import NxVulnerabilityIndicatorLegend from '../NxVulnerabilityIndicatorLegend';

describe('NxVulnerabilityIndicatorLegend', function() {
  const quickRender = rtlRender(NxVulnerabilityIndicatorLegend, {}),
      renderEl = rtlRenderElement(NxVulnerabilityIndicatorLegend, {});

  const vulnerabilitySeverityRatings = {
    critical: true,
    high: true,
    medium: true,
    low: true,
    none: true
  };

  it('fowards a ref to the top rating element', function() {
    const ref = React.createRef<HTMLDivElement>(),
        el = renderEl({ ref: ref, ...vulnerabilitySeverityRatings });

    expect(ref.current).toBe(el);
  });

  it('adds specified classes and attributes to top-rating element', function() {
    const defaultEl = renderEl(vulnerabilitySeverityRatings)!,
        el = renderEl({ className: 'bar', id: 'foo', lang: 'en', ...vulnerabilitySeverityRatings })!;

    expect(el).toHaveAttribute('id', 'foo');
    expect(el).toHaveAttribute('lang', 'en');

    expect(el).toHaveClass('bar');

    for (const cls of Array.from(defaultEl.classList)) {
      expect(el).toHaveClass(cls);
    }
  });

  it('renders default legend label', function() {
    expect(quickRender(vulnerabilitySeverityRatings).getByText('Legend')).toBeInTheDocument();
  });

  it('renders custom label when header is provided', function() {
    const el = quickRender({ header: 'Test Test', ...vulnerabilitySeverityRatings });

    expect(el.getByText('Test Test')).toBeInTheDocument();
    expect(el.queryByText('Legend')).not.toBeInTheDocument();
  });

  it('renders nothing if no vulnerability ratings are provided', function() {
    const el = renderEl();
    expect(el).not.toBeInTheDocument();
  });

  it('renders nothing if all vulnerability ratings are null', function() {
    const el = renderEl({
      critical: null,
      high: null,
      medium: null,
      low: null,
      none: null
    });
    expect(el).not.toBeInTheDocument();
  });

  it('renders correct legend items', function() {
    const el = quickRender({ 
      critical: true,
      high: true,
      low: true,
      none: true
    });

    expect(el.getByText('Low')).toBeInTheDocument();
    expect(el.getByText('High')).toBeInTheDocument();
    expect(el.getByText('Critical')).toBeInTheDocument();
    expect(el.getByText('None')).toBeInTheDocument();
    expect(el.queryByText('Medium')).not.toBeInTheDocument();
  });

  // vertical prop only affects visual layout
});

